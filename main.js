var x=0;function y(a){if(FileReader&&a&&a.length){var d=document.querySelectorAll(".box")[0];d.classList.add("is-uploading");x+=a.length;for(var b=0;b<a.length;b++)(function(a){var b=new FileReader;b.onload=function(){var e=document.createElement("canvas"),g=e.getContext("2d"),c=new Image;c.onload=function(){e.width=c.width;e.height=c.height;g.fillStyle="#fff";g.fillRect(0,0,c.width,c.height);g.drawImage(c,0,0);var b=a.name.replace(/\.\w{1,}$/,".jpg");if(e.msToBlob){for(var h=atob(e.toDataURL("image/jpeg",1).split(",")[1]),k=new ArrayBuffer(h.length),l=new Uint8Array(k),f=0;f<h.length;f++)l[f]=h.charCodeAt(f);window.navigator.msSaveBlob(new Blob([k],{type:"image/jpeg"}),b)}else e.toBlob(function(a){var c=document.createElement("a");c.href=URL.createObjectURL(a);c.download=b;c.style="display:none";document.body.appendChild(c);c.click();c.remove()},"image/jpeg",1);--x;0>=x&&(d.classList.remove("is-uploading"),d.classList.add("is-success"))};c.src=b.result};b.readAsDataURL(a)})(a[b])}}function z(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&"FormData"in window&&"FileReader"in window}var forms=document.querySelectorAll(".box");Array.prototype.forEach.call(forms,function(a){var d=a.querySelector(".box_file");d.addEventListener("change",function(a){y(a.target.files)});z&&(a.classList.add("has-advanced-upload"),"drag dragstart dragend dragover dragenter dragleave drop".split(" ").forEach(function(b){a.addEventListener(b,function(a){a.preventDefault();a.stopPropagation()})}),["dragover","dragenter"].forEach(function(b){a.addEventListener(b,function(){a.classList.add("is-dragover")})}),["dragleave","dragend","drop"].forEach(function(b){a.addEventListener(b,function(){a.classList.remove("is-dragover")})}),a.addEventListener("drop",function(a){y(a.dataTransfer.files)}),a.addEventListener("click",function(){d.click()}))});